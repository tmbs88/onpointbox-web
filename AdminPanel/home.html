<!DOCTYPE html>
<!--
  ~ OnPointBox a schedule manager for group classes
  ~ Copyright (C) 2015  Tiago Miguel Basilio da Silva
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<html lang="en">
	<head>
		<meta charset="utf-8">

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>Homepage</title>
		<meta name="description" content="">
		<meta name="author" content="Tiago Miguel Basilio Silva">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">


		<!-- CDN sources -->
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/jquery.qtip.min.css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.1/fullcalendar.min.css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.0/bootstrap-table.min.css">

		<!-- local sources -->
   		<link href="/css/sticky-footer-navbar.css" rel="stylesheet">
   		<link href="/css/normalize.css" rel="stylesheet">
   		
   		<link href="/css/greenTheme.css" rel="stylesheet">
   	</head>

	<body>

		<nav class="navbar navbar-default navbar-fixed-top">
	    	<div class="container">
	        	<div class="navbar-header">
	        		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigationbar">
			       <span class="sr-only">Toggle navigation</span>
			       <span class="icon-bar"></span>
			       <span class="icon-bar"></span>
			       <span class="icon-bar"></span>
			       	</button>
	          		<a class="navbar-brand" href="/AdminPanel/">onPointBox Admin Panel</a>
	        	</div>
	        	<div class="collapse navbar-collapse" id="navigationbar">
		          <ul class="nav navbar-nav">
		            <li><a href="/AdminPanel/classes">Classes</a></li>
		            <li><a href="/AdminPanel/instructors">Instructors</a></li>
		            <li><a href="/AdminPanel/trainees">Trainees</a></li>
		           
		          </ul>
			      	<ul class="nav navbar-nav navbar-right">
			      		<li><a href="/AdminPanel/settings">Settings</a></li>
			      		<li><a href="/AdminPanel/logout">Logout <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span></a></li>
			      	</ul>
		        </div>
	      	</div>
	    </nav>
			<div class="container">
				<div class="row">
					<div class="col-sm-12">
						<div class="panel panel-default">
							<div class="panel-heading">

							    <h3 class="panel-title">Calendar</h3>
							</div>
							<div class="panel-body">
								
								<div id='calendar'></div>
							</div>
						</div>
					</div>
	            </div>
	            <div class="row">
					<div class="col-sm-12">
						<div class="panel panel-default">
							<div class="panel-heading">

							    <h3 class="panel-title">Classes</h3>
							</div>
							<div class="panel-body">
								
								<table id="bootstrap-table"></table>
							</div>
						</div>
					</div>
	            </div>
			</div>

			<footer class="footer">
				<div class="container">
		        	<p class="text-muted">&copy; Copyright  by Tiago Miguel Basilio Silva</p>
		    	</div>
			</footer>
		
		<div class="modal fade" id="stulist" tabindex="-1" role="dialog">
			  	<div class="modal-dialog">
			    	<div class="modal-content">
				      	<div class="modal-header">
				        	<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
				        	<h4 class="modal-title">Enrolled Trainees</h4>
				      	</div>
				      	<div class="modal-body">
				          	<div class="well well-lg">
					        	<div class="row">
								  
								 
								</div>
					        </div>
				      	</div>
			    	</div>
			  	</div>
			</div>

		<!-- sources -->
		<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		
		<script src='/js/moment-min.js'></script>
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.1/fullcalendar.min.js"></script>
		
		<script src='/js/fullcalendar_pt.js'></script> <!-- TODO: ADD other languages -->
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/jquery.qtip.min.js"></script>
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.0/bootstrap-table.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.0/locale/bootstrap-table-pt-PT.min.js"></script> <!-- TODO: ADD other languages -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.0/extensions/mobile/bootstrap-table-mobile.min.js"></script>
				
		<script src="/js/strformat.js"></script>
		

		<script type="text/javascript">
		
			function ajaxGetStu(cid) {
				return $.ajax({
					url: "/php/instructors/classes_insc_stu.php",
					type : "POST",
					data : { "cid" : cid },
					datatype: "json" 
				}).done(function(data) {
					var parsed = JSON.parse(data);
					for(o in parsed.db.rows){
						
						
						/*
					<div class="col-xs-6 col-sm-3 col-md-3">
								    <div class="thumbnail">
								      <img src="/uimages/default.gif" style='width: 100%;max-height: 100%' class="img-rounded">
								      <div class="caption">
								        <h6>Thumbnail label</h6>
								        <p>...</p>
								      </div>
								    </div>
								 </div>*/
					
						div1 = $("<div>").attr("class","col-xs-6 col-sm-3 col-md-3");
						div2 = $("<div>").attr("class","thumbnail");
						img = $("<img>").attr( {
													"src" : "/"+parsed.db.rows[o].img,
													//"style" : "height: auto",//"width: 100%;max-height: 100%",
													"class" : "img-rounded"
										});
						h = $("<h6>").attr("class", "text-center").append(parsed.db.rows[o].name);
						
						div1.append(div2);
						div2.append(img);
						div2.append(h);
						
						
						$('#stulist .row').append(div1);
						
						//parsed.db.rows[o].duration = timestringformater(parsed.db.rows[o].duration);
						//parsed.db.rows[o].start = timestringformater(parsed.db.rows[o].start);
						//parsed.db.rows[o].end = timestringformater(parsed.db.rows[o].end);
					}
					
					//location.assign("/Instructors/list/");
				}).fail(function() {
					//location.assign("home.html");
				});
			}
			
			function actionFormatter(value, row, index) {
		    	var btn;
				if(row.insc != 0) {
					btn= "<button type='button' class='btn btn-default btn-sm' data-toggle='modal' data-target='#stulist'>+Info</button>";
				}
		    	
		    	return [
			        btn
			    ].join('');
			}
			
			window.actionEvents = {
			    'click .btn': function (e, value, row, index) {
			    	ajaxGetStu(row.ida);
			        //alert('You click success icon, row: ' + JSON.stringify(row));
			    }
			};
			
	    	$(document).ready(function(){
	    		$.ajax({
					url: "/php/h_classes_list.php",
					type : "post",
					datatype: "json" 
				}).done(function(data) {
					var parsed = JSON.parse(data);

					for(o in parsed.db.rows){
						
						parsed.db.rows[o].duration = timestringformater(parsed.db.rows[o].duration);
						parsed.db.rows[o].start = timestringformater(parsed.db.rows[o].start);
						parsed.db.rows[o].end = timestringformater(parsed.db.rows[o].end);
					}
					
					$('#bootstrap-table').bootstrapTable({
						classes: 'table table-no-bordered',
					    striped: true,
					    columns: [{
							        field: 'id',
							        visible: false,
							        searchable: false
							    }, {
							        field: 'title',
							        title: 'Name',
							        sortable: true,
							        switchable: false
							    }, {
							        field: 'start',
							        title: 'Data',
							        sortable: true,
					    			switchable: false
							    }, {
							        field: 'duration',
							        title: 'Duration',
							        searchable: false,
							    }, {
							        field: 'description',
							        title: 'Description',
							        searchable: false,
							        visible: false,
							    }, {
							        field: 'instructor',
							        title: 'Instructor',
							        sortable: true,
							    }, {
							        field: 'max',
							        title: 'Capacity',
							        searchable: false,
							    }, {
							        field: 'insc',
							        title: 'Enrolled',
							        searchable: false,
							    }, {
							    	field: 'action',
							    	title: 'Trainees',
							    	formatter: 'actionFormatter',
							    	events: 'actionEvents'
							    }],
					    data: parsed.db.rows,
					    search: true,
					    showToggle: true,
					    idField: 'id',
					    uniqueId: 'id',
					    showColumns: true,
					    //clickToSelect: true,
					    mobileResponsive: true,
					    //cardView: true
					    pagination: true
					    
					});
					
					
					$(window).resize(function () {
				        $('#bootstrap-table').bootstrapTable('resetView');
				    });
				}).fail(function() {
					//location.assign("home.html");
				});
				
				$('#calendar').fullCalendar({
					header: {
						left: 'prev,next today',
						center: 'title',
						right: 'month,agendaWeek,agendaDay'
					},
					editable: false,
					lang: 'pt',
					allDaySlot: 'false',
					axisFormat: 'H:mm',
					buttonIcons: false, // show the prev/next text
					eventLimit: true, // allow "more" link when too many events
					defaultView: 'agendaWeek',
					events: {
						        url: '/php/schedule_feed.php',
						        //type: 'GET',
						        error: function(a, b, c) {
						            alert('there was an error while fetching events!'+c);
						        },
						        //color: 'yellow',   // a non-ajax option
						        textColor: 'black' // a non-ajax option
						   },
					eventRender: function(event, element) {
				        //element.find('.fc-title').append("<br/>" + event.description);
				        var text = "";
				        if(event.max != null){
				        	var vacancies = event.max - event.insc;
				        	text += "<p><strong>Vacancies </strong>"+vacancies+"/"+event.max+"</p>";
				        }
				        
				        text += "<p><strong>Instructor </strong>"+event.instructor+"</p>";
				        text += "<p><strong>Description </strong>"+event.description+"</p>";
				        
				        
				        
				        element.qtip({
					                    content : {
					                    	text : text
					                    },
					                    position: {
									        my: 'top left',  // Position my top left...
									        at: 'bottom middle', // at the bottom right of...
									        target: element, // my target
									        viewport: $(window)
									    },
									    style: {
									        classes: 'qtip-light qtip-shadow qtip-rounded'
									    }
					                    
					                 });
				  	},
				   	eventMouseover: function(event) {
				        $(this).qtip();
				    },
					eventMouseout: function(event) {
				        $(this).qtip().hide();
				    }
				});
				
				$('#stulist').on('hidden.bs.modal', function () {
					$(this).find('.row').empty();
				});
			});

		</script>
	</body>
</html>
